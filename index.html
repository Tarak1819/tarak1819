<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RIRM presents EDU PLAY: Interactive Education</title>
<style>
    /* --- GLOBAL STYLES (Modern/Vibrant Theme) --- */
    :root {
        --bg-color: #0a0a12;
        --panel-bg: #11111a;
        --text-color: #e0e0e0;
        --neon-cyan: #00f3ff;
        --neon-green: #00ff41;
        --neon-red: #ff0055;
        --neon-yellow: #fcee0a;
        --neon-purple: #bc13fe;
        --glass: rgba(255, 255, 255, 0.05);
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        height: 100vh;
        overflow-x: hidden;
    }

    /* --- UTILITIES --- */
    .hidden { display: none !important; }
    .btn-main {
        background: linear-gradient(45deg, var(--neon-cyan), #00a8ff);
        border: none;
        padding: 12px 24px;
        color: #000;
        font-weight: bold;
        border-radius: 25px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    .btn-main:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px var(--neon-cyan);
    }
    .btn-sec {
        background: transparent;
        border: 2px solid var(--neon-purple);
        color: var(--neon-purple);
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: bold;
    }
    .btn-sec:hover { background: rgba(188, 19, 254, 0.1); box-shadow: 0 0 15px var(--neon-purple); }

    /* --- AUTH SCREEN --- */
    #auth-screen {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: radial-gradient(circle at center, #1a1a24 0%, #000 100%);
    }
    .auth-box {
        background: var(--panel-bg);
        padding: 40px;
        border-radius: 15px;
        border: 1px solid var(--neon-cyan);
        box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
        width: 350px;
        text-align: center;
    }
    .auth-box h2 { color: var(--neon-cyan); margin-bottom: 20px; }
    .input-group { margin-bottom: 15px; text-align: left; }
    .input-group label { display: block; font-size: 12px; margin-bottom: 5px; color: #888; }
    .input-group input {
        width: 100%;
        padding: 10px;
        background: #000;
        border: 1px solid #333;
        color: #fff;
        border-radius: 5px;
        box-sizing: border-box;
    }
    .input-group input:focus { border-color: var(--neon-cyan); outline: none; }
    .toggle-link {
        margin-top: 15px;
        font-size: 12px;
        color: #888;
        cursor: pointer;
        text-decoration: underline;
    }

    /* --- DASHBOARD --- */
    #dashboard-screen {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    header {
        background: var(--panel-bg);
        padding: 15px 30px;
        border-bottom: 1px solid #333;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .logo { font-size: 24px; font-weight: bold; color: var(--neon-green); text-shadow: 0 0 10px rgba(0,255,65,0.3); }
    .profile-widget {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .profile-info { text-align: right; font-size: 12px; }
    .profile-name { color: var(--neon-cyan); font-weight: bold; font-size: 14px; }
    .profile-circle {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan));
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: #000;
        border: 2px solid #fff;
    }

    /* --- CONTENT AREA --- */
    #content-area {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
        box-sizing: border-box;
    }
    .step-container {
        animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    .grid-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .card {
        background: var(--glass);
        border: 1px solid #333;
        padding: 20px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 120px;
    }
    .card:hover {
        background: rgba(0, 243, 255, 0.1);
        border-color: var(--neon-cyan);
        transform: translateY(-5px);
    }
    .card-icon { font-size: 40px; margin-bottom: 10px; }
    .card-title { font-weight: bold; color: #fff; }
    
    .back-btn {
        background: none;
        border: none;
        color: #888;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 20px;
    }
    .back-btn:hover { color: #fff; }

    /* --- SPECIFIC GAME STYLES (From Prompt) --- */
    #game-container {
        display: flex;
        width: 100%;
        height: 100%;
        background-color: #0a0a12;
    }
    #game-area {
        flex: 2;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        background: radial-gradient(circle at center, #1a1a24 0%, #000 100%);
    }
    #control-panel {
        flex: 1;
        background-color: var(--panel-bg);
        border-left: 2px solid var(--neon-cyan);
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        box-shadow: -10px 0 20px rgba(0, 243, 255, 0.1);
        overflow-y: auto;
    }
    #board-wrapper { position: relative; width: 600px; height: 600px; }
    #grid {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(10, 1fr);
        width: 100%; height: 100%;
        border: 2px solid var(--neon-cyan);
        background-color: rgba(0,0,0,0.5);
    }
    .cell { border: 1px solid #1f1f2e; position: relative; cursor: pointer; }
    .cell:hover { background-color: rgba(0, 243, 255, 0.1); }
    .wall {
        background-color: #333;
        background-image: repeating-linear-gradient(45deg, #222 0, #222 10px, #333 10px, #333 20px);
        border: 1px solid var(--neon-red);
        cursor: not-allowed;
    }
    .source {
        background-color: rgba(0, 243, 255, 0.2);
        border: 2px solid var(--neon-cyan);
        display: flex; justify-content: center; align-items: center;
        color: var(--neon-cyan); font-weight: bold;
    }
    .source::after { content: "S"; }
    .target {
        background-color: rgba(0, 255, 65, 0.2);
        border: 2px solid var(--neon-green);
        border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
    }
    .target::after { content: "T"; color: var(--neon-green); font-weight: bold; }
    .mirror-obj {
        position: absolute; top: 50%; left: 50%;
        width: 80%; height: 4px;
        background-color: var(--neon-cyan);
        box-shadow: 0 0 8px var(--neon-cyan);
        transform-origin: center;
        pointer-events: none;
    }
    .cell.selected .mirror-obj { background-color: white; box-shadow: 0 0 12px white; }
    #laser-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
    
    /* Game Modals */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85);
        display: flex; justify-content: center; align-items: center; z-index: 100;
    }
    .modal-content {
        background: #11111a;
        border: 2px solid var(--neon-cyan);
        padding: 30px; max-width: 500px;
        text-align: center; color: white;
    }
    
    /* Input/Range Overrides for Game */
    input[type="range"] { width: 100%; accent-color: var(--neon-cyan); }
    .game-btn {
        padding: 10px; background: transparent; border: 1px solid var(--neon-cyan);
        color: var(--neon-cyan); cursor: pointer; text-transform: uppercase; margin: 5px;
    }
    .game-btn:hover { background: var(--neon-cyan); color: #000; }
</style>
</head>
<body>

    <div id="auth-screen">
        <div id="login-form" class="auth-box">
            <h2>STUDENT LOGIN</h2>
            <div class="input-group">
                <label>Student ID (8 Digits)</label>
                <input type="text" id="login-id" placeholder="e.g., 12345678" maxlength="8">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn-main" onclick="handleLogin()">Log In</button>
            <div class="toggle-link" onclick="toggleAuth('register')">New Student? Register Here</div>
        </div>

        <div id="register-form" class="auth-box hidden">
            <h2>NEW REGISTRATION</h2>
            <div class="input-group">
                <label>Full Name</label>
                <input type="text" id="reg-name" placeholder="John Doe">
            </div>
            <div class="input-group">
                <label>Create Password</label>
                <input type="password" id="reg-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <div class="input-group">
                <label>Confirm Password</label>
                <input type="password" id="reg-pass-conf" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn-main" onclick="handleRegister()">Generate ID & Register</button>
            <div class="toggle-link" onclick="toggleAuth('login')">Already have an ID? Login</div>
        </div>
    </div>

    <div id="dashboard-screen" class="hidden">
        <header>
            <div class="logo">EDU PLAY</div>
            <div class="profile-widget">
                <div class="profile-info">
                    <div class="profile-name" id="disp-name">Student Name</div>
                    <div style="color: #888;">ID: <span id="disp-id">00000000</span></div>
                    <div style="color: var(--neon-green);">Progress: Level 1</div>
                </div>
                <div class="profile-circle" onclick="handleLogout()">
                    <span id="disp-initial">S</span>
                </div>
            </div>
        </header>

        <div id="content-area">
            <button class="back-btn hidden" id="global-back-btn" onclick="goBack()">
                &#8592; Back to Previous Step
            </button>

            <div id="step-class" class="step-container">
                <h2 style="color: var(--neon-cyan);">Select Your Class</h2>
                <div class="grid-options" id="class-grid"></div>
            </div>

            <div id="step-subject" class="step-container hidden">
                <h2 style="color: var(--neon-purple);">Select Subject</h2>
                <div class="grid-options" id="subject-grid"></div>
            </div>

            <div id="step-chapter" class="step-container hidden">
                <h2 style="color: var(--neon-green);">Select Chapter</h2>
                <select id="master-chapter-list" class="hidden">
                   <optgroup label="Class 6 - Science">
                       <option value="C6_SCI_1">Class 6 - Science - Ch 1: Components of Food</option>
                       <option value="C6_SCI_2">Class 6 - Science - Ch 2: Sorting Materials into Groups</option>
                       <option value="C6_SCI_3">Class 6 - Science - Ch 3: Separation of Substances</option>
                       <option value="C6_SCI_4">Class 6 - Science - Ch 4: Getting to Know Plants</option>
                       <option value="C6_SCI_5">Class 6 - Science - Ch 5: Body Movements</option>
                       <option value="C6_SCI_6">Class 6 - Science - Ch 6: The Living Organisms</option>
                       <option value="C6_SCI_7">Class 6 - Science - Ch 7: Motion and Measurement of Distances</option>
                       <option value="C6_SCI_8">Class 6 - Science - Ch 8: Light, Shadows and Reflections</option>
                       <option value="C6_SCI_9">Class 6 - Science - Ch 9: Electricity and Circuits</option>
                       <option value="C6_SCI_10">Class 6 - Science - Ch 10: Fun with Magnets</option>
                       <option value="C6_SCI_11">Class 6 - Science - Ch 11: Air Around Us</option>
                   </optgroup>
                   <optgroup label="Class 7 - Science">
                       <option value="C7_SCI_1">Class 7 - Science - Ch 1: Nutrition in Plants</option>
                       <option value="C7_SCI_2">Class 7 - Science - Ch 2: Nutrition in Animals</option>
                       <option value="C7_SCI_3">Class 7 - Science - Ch 3: Heat</option>
                       <option value="C7_SCI_4">Class 7 - Science - Ch 4: Acids, Bases and Salts</option>
                       <option value="C7_SCI_5">Class 7 - Science - Ch 5: Physical and Chemical Changes</option>
                       <option value="C7_SCI_6">Class 7 - Science - Ch 6: Respiration in Organisms</option>
                       <option value="C7_SCI_7">Class 7 - Science - Ch 7: Transportation in Animals and Plants</option>
                       <option value="C7_SCI_8">Class 7 - Science - Ch 8: Reproduction in Plants</option>
                       <option value="C7_SCI_9">Class 7 - Science - Ch 9: Motion and Time</option>
                       <option value="C7_SCI_10">Class 7 - Science - Ch 10: Electric Current and its Effects</option>
                       <option value="C7_SCI_11">Class 7 - Science - Ch 11: Light</option>
                       <option value="C7_SCI_12">Class 7 - Science - Ch 12: Forests: Our Lifeline</option>
                       <option value="C7_SCI_13">Class 7 - Science - Ch 13: Wastewater Story</option>
                   </optgroup>
                   <optgroup label="Class 11 - Physics">
                       <option value="C11_PHY_1">Class 11 - Physics - Ch 1: Physical World</option>
                       <option value="C11_PHY_2">Class 11 - Physics - Ch 2: Units and Measurements</option>
                       <option value="C11_PHY_3">Class 11 - Physics - Ch 3: Motion in a Straight Line</option>
                       <option value="C11_PHY_4">Class 11 - Physics - Ch 4: Motion in a Plane</option>
                       <option value="C11_PHY_5">Class 11 - Physics - Ch 5:  Work, Energy, and Power</option>
                       <option value="C11_PHY_6">Class 11 - Physics - Ch 6: System of Particles and Rotational Motion</option>
                       <option value="C11_PHY_7">Class 11 - Physics - Ch 7: Gravitation</option>
                       <option value="C11_PHY_8">Class 11 - Physics - Ch 8: Mechanical Properties of Solids</option>
                       <option value="C11_PHY_9">Class 11 - Physics - Ch 9: Mechanical Properties of Fluids</option>
                       <option value="C11_PHY_10">Class 11 - Physics - Ch 10: Thermal Properties of Matter</option>
                       <option value="C11_PHY_11">Class 11 - Physics - Ch 12: Thermodynamics</option>
                       <option value="C11_PHY_12">Class 11 - Physics - Ch 12: Kinetic Theory</option>
                       <option value="C11_PHY_13">Class 11 - Physics - Ch 13:  Oscillations</option>
                       <option value="C11_PHY_14">Class 11 - Physics - Ch 14:  Waves </option>

                   </optgroup>
                   <optgroup label="Class 12 - Physics">
                       <option value="C12_PHY_1">Class 12 - Physics - Ch 1: Rotational Motions</option>
                       <option value="C12_PHY_2">Class 12 - Physics - Ch 2: Rotational Motions123</option>
                   </optgroup>
                   <optgroup label="Class 9 - Physics">
                       <option value="C9_PHY_1">Class 9 - Physics - Ch 1: Motions</option>
                       <option value="C9_PHY_2">Class 9 - Physics - Ch 2: Force and Laws of Motion</option>
                       <option value="C9_PHY_3">Class 9 - Physics - Ch 03: Gravitation </option>
                       <option value="C9_PHY_4">Class 9 - Physics - Ch 04: Work and Energy </option>
                       <option value="C9_PHY_5">Class 9 - Physics - Ch 05: Sound </option>

                   </optgroup>

                </select>
                <div class="grid-options" id="chapter-grid"></div>
            </div>

            <div id="step-concept" class="step-container hidden">
                <h2 style="color: var(--neon-yellow);">Select Concept</h2>
                <div class="grid-options" id="concept-grid"></div>
            </div>

             <div id="step-games" class="step-container hidden">
                <h2 style="color: var(--neon-red);">Select Activity</h2>
                <div class="grid-options" id="game-grid"></div>
            </div>
        </div>
    </div>

    <div id="game-overlay" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:999; background:#000;">
        <div id="start-modal" class="modal">
            <div class="modal-content">
                <h1 style="color:var(--neon-cyan)">Mirror Master</h1>
                <h2 style="color:var(--neon-green)">Laws of Reflection</h2>
                <div style="text-align:left; border-left:3px solid var(--neon-green); padding:10px; margin:15px 0; background:rgba(255,255,255,0.05)">
                    <p><strong>The Law:</strong> The Angle of Incidence (i) equals the Angle of Reflection (r).</p>
                </div>
                <button class="game-btn" onclick="GameEngine.start()">Start Simulation</button>
                <button class="game-btn" style="border-color:var(--neon-red)" onclick="exitGame()">Exit Game</button>
            </div>
        </div>
        
        <div id="result-modal" class="modal hidden">
            <div class="modal-content">
                <h1 style="color:var(--neon-green)">Target Hit!</h1>
                <p>Perfect reflection logic.</p>
                <button class="game-btn" onclick="GameEngine.reset()">Replay</button>
                <button class="game-btn" onclick="exitGame()">Exit</button>
            </div>
        </div>

        <div id="game-container">
            <div id="game-area">
                <div id="board-wrapper">
                    <div id="grid"></div>
                    <svg id="laser-layer"></svg>
                </div>
            </div>

            <div id="control-panel">
                <h2 style="color:var(--neon-cyan)">CONTROLS</h2>
                <div>
                    <label>Source Angle: <span id="source-angle-val">0</span>Â°</label>
                    <input type="range" id="source-slider" min="0" max="359" value="0" oninput="GameEngine.updateSourceAngle(this.value)">
                </div>
                
                <div id="mirror-controls" style="opacity:0.5; pointer-events:none;">
                    <label>Mirror Angle: <span id="mirror-angle-val">135</span>Â°</label>
                    <input type="range" id="mirror-slider" min="0" max="179" value="135" oninput="GameEngine.updateMirrorAngle(this.value)">
                    <button class="game-btn" onclick="GameEngine.removeMirror()" style="border-color:var(--neon-red); font-size:10px; width:100%;">Remove Mirror</button>
                </div>

                <div style="margin-top:auto;">
                    <button class="game-btn" style="width:100%;" onclick="GameEngine.fire()">FIRE LASER</button>
                    <button class="game-btn" style="width:100%; border-color:var(--neon-red); color:var(--neon-red);" onclick="GameEngine.reset()">RESET</button>
                    <button class="game-btn" style="width:100%; margin-top:10px;" onclick="exitGame()">EXIT</button>
                </div>
            </div>
        </div>
    </div>

<script>
/* ==========================================
   1. AUTHENTICATION MODULE
   ========================================== */
const Auth = {
    domain: window.localStorage,
    
    register: function() {
        const name = document.getElementById('reg-name').value;
        const pass = document.getElementById('reg-pass').value;
        const conf = document.getElementById('reg-pass-conf').value;

        if(!name || !pass || !conf) return alert("Please fill all fields");
        if(pass !== conf) return alert("Passwords do not match");

        // Generate 8 digit unique ID
        let newID;
        do {
            newID = Math.floor(10000000 + Math.random() * 90000000).toString();
        } while (this.domain.getItem(newID));

        const userObj = { name: name, pass: pass, progress: 'Level 1' };
        this.domain.setItem(newID, JSON.stringify(userObj));
        
        alert(`Registration Successful!\nYour Student ID is: ${newID}\nPlease write this down.`);
        toggleAuth('login');
    },

    login: function() {
        const id = document.getElementById('login-id').value;
        const pass = document.getElementById('login-pass').value;
        
        const data = this.domain.getItem(id);
        if(!data) return alert("Invalid ID");
        
        const user = JSON.parse(data);
        if(user.pass === pass) {
            this.initSession(id, user);
        } else {
            alert("Incorrect Password");
        }
    },

    initSession: function(id, user) {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('dashboard-screen').classList.remove('hidden');
        document.getElementById('disp-name').innerText = user.name;
        document.getElementById('disp-id').innerText = id;
        document.getElementById('disp-initial').innerText = user.name.charAt(0).toUpperCase();
        
        // Start Navigation at Class Selection
        Nav.loadClasses();
    },

    logout: function() {
        document.getElementById('dashboard-screen').classList.add('hidden');
        document.getElementById('auth-screen').classList.remove('hidden');
        document.getElementById('login-id').value = '';
        document.getElementById('login-pass').value = '';
    }
};

/* ==========================================
   2. NAVIGATION & CONTENT MODULE
   ========================================== */
const Nav = {
    history: [],
    currentStep: 'class',
    
    // Class Definitions
    classes: ['cl6', 'cl7', 'cl8', 'cl9', 'cl10', 'cl11', 'cl12'],
    
    loadClasses: function() {
        this.renderGrid('class-grid', this.classes.map(c => ({
            id: c,
            label: `Class ${c.replace('cl', '')}`,
            icon: 'ðŸŽ“',
            action: () => this.selectClass(c)
        })));
        this.showStep('step-class');
    },

    selectClass: function(clsId) {
        this.pushState('step-class');
        let subjects = [];
        const num = parseInt(clsId.replace('cl', ''));
        
        if (num <= 8) {
            subjects = [
                { id: `${clsId}ma`, label: 'Mathematics', icon: 'ðŸ“' },
                { id: `${clsId}sc`, label: 'Science', icon: 'ðŸ”¬' }
            ];
        } else {
            subjects = [
                { id: `${clsId}ph`, label: 'Physics', icon: 'âš›ï¸' },
                { id: `${clsId}ch`, label: 'Chemistry', icon: 'ðŸ§ª' },
                { id: `${clsId}bi`, label: 'Biology', icon: 'ðŸ§¬' },
                { id: `${clsId}ma`, label: 'Mathematics', icon: 'âˆ«' }
            ];
        }
        
        this.renderGrid('subject-grid', subjects.map(s => ({
            ...s, action: () => this.selectSubject(s.id, num)
        })));
        this.showStep('step-subject');
    },

    selectSubject: function(subId, classNum) {
        this.pushState('step-subject');
        
        // Filter options from the hidden select list provided in prompt
        const select = document.getElementById('master-chapter-list');
        const optGroups = select.getElementsByTagName('optgroup');
        let chapters = [];

        // Simple string matching to find relevant optgroup
        // In a real app this would be more robust, but fitting prompt data structure
        const searchStr = `Class ${classNum} - ${this.getSubjectName(subId)}`;
        
        for (let group of optGroups) {
            if (group.label.includes(searchStr)) {
                for (let opt of group.children) {
                    chapters.push({
                        id: opt.value,
                        label: opt.text,
                        icon: 'ðŸ“–',
                        action: () => this.selectChapter(opt.value)
                    });
                }
            }
        }

        // Fallback if no chapters found in the prompt's snippet for that class
        if(chapters.length === 0) {
            chapters.push({ id: 'dummy', label: 'More chapters coming soon...', icon: 'ðŸš§', action: ()=>{} });
        }

        this.renderGrid('chapter-grid', chapters);
        this.showStep('step-chapter');
    },

    selectChapter: function(chapId) {
        this.pushState('step-chapter');
        // Generate 20 Concepts
        const concepts = [];
        for(let i=1; i<=20; i++) {
            const code = `${chapId}_CP${i}`;
            let name = `Concept ${i}`;
            
            // SPECIFIC OVERRIDE FROM PROMPT
            if(code === 'C7_SCI_11_CP1') name = "Reflection of Light";
            
            concepts.push({
                id: code,
                label: name,
                icon: 'ðŸ’¡',
                action: () => this.selectConcept(code)
            });
            // SPECIFIC OVERRIDE FROM PROMPT
            if(code === 'C9_PHY_2_CP1') name = "NEWTON'S FIRST LAW OF MOTION";
            
            concepts.push({
                id: code,
                label: name,
                icon: 'ðŸŽ“',
                action: () => this.selectConcept(code)
            });
            // SPECIFIC OVERRIDE FROM PROMPT
            if(code === 'C11_PHY_6_CP1') name = "TORQUES";
            
            concepts.push({
                id: code,
                label: name,
                icon: 'ðŸ§‘â€ðŸ«',
                action: () => this.selectConcept(code)
            });


        }
        this.renderGrid('concept-grid', concepts);
        this.showStep('step-concept');
    },

    selectConcept: function(conceptId) {
        this.pushState('step-concept');
        // Generate 6 Games
        const games = [];
        for(let i=1; i<=6; i++) {
            const code = `${conceptId}_G${i}`;
            let name = `Activity ${i}`;
            let icon = 'ðŸŽ®';
            
            // SPECIFIC OVERRIDE FROM PROMPT
            if(code === 'C7_SCI_11_CP1_G2') {
                name = "Activity 2";
                icon = 'ðŸŽ®';
            }

         		   // SPECIFIC OVERRIDE FROM PROMPT
        		   if(code === 'C7_SCI_11_CP1_G1') {
                		name = '<a href="laser.html" target="_blank">MIRROR MASTER OLD</a>';
                		icon = 'ðŸªž';
           		 }
            
         		   // SPECIFIC OVERRIDE FROM PROMPT
        		   if(code === 'C11_PHY_6_CP1_G1') {
                		name = "<a href='tqm.html'>TORQUE MASTER</a>";
                		icon = 'ðŸ’³';
           		 }
         		   // SPECIFIC OVERRIDE FROM PROMPT
        		   if(code === 'C11_PHY_14_CP1_G1') {
                		name = "<a href='waves.html'>Torque Master</a>";
                		icon = 'ðŸ”Š';
           		 }
         		   // SPECIFIC OVERRIDE FROM PROMPT
        		   if(code === 'C9_PHY_2_CP1_G1') {
                		name = "<a href='TARAK.html'>Foot Ball</a>";
                		icon = 'âš½';
           		 }
         		   // SPECIFIC OVERRIDE FROM PROMPT
        		   if(code === 'C9_PHY_2_CP1_G2') {
                		name = "<a href='carromm.html'>Carroms</a>";
                		icon = 'â–¶ï¸';
           		 }



            games.push({
                id: code,
                label: name,
                icon: icon,
                action: () => this.launchGame(code)
            });
        }
        this.renderGrid('game-grid', games);
        this.showStep('step-games');
    },

    launchGame: function(gameCode) {
        if(gameCode === 'C7_SCI_11_CP1_G1') {
            document.getElementById('dashboard-screen').classList.add('hidden');
            document.getElementById('game-overlay').classList.remove('hidden');
            GameEngine.init(); // Start the provided code
        } else {
            alert(`Game ${gameCode} content loading...`);
        }
    },

    // Utilities
    getSubjectName: function(id) {
        if(id.includes('ma')) return 'Maths';
        if(id.includes('sc')) return 'Science';
        if(id.includes('ph')) return 'Physics';
        if(id.includes('ch')) return 'Chemistry';
        if(id.includes('bi')) return 'Biology';
        return '';
    },
    
    renderGrid: function(containerId, items) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<div class="card-icon">${item.icon}</div><div class="card-title">${item.label}</div>`;
            card.onclick = item.action;
            container.appendChild(card);
        });
    },

    showStep: function(stepId) {
        // Hide all steps
        document.querySelectorAll('.step-container').forEach(el => el.classList.add('hidden'));
        document.getElementById(stepId).classList.remove('hidden');
        
        // Show back button if not at start
        const btn = document.getElementById('global-back-btn');
        if(stepId === 'step-class') btn.classList.add('hidden');
        else btn.classList.remove('hidden');
    },

    pushState: function(currentStepId) {
        this.history.push(currentStepId);
    },

    back: function() {
        if(this.history.length > 0) {
            const prev = this.history.pop();
            this.showStep(prev);
        }
    }
};

/* ==========================================
   3. GLOBAL HANDLERS
   ========================================== */
function toggleAuth(mode) {
    if(mode === 'register') {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('register-form').classList.remove('hidden');
    } else {
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
    }
}
function handleLogin() { Auth.login(); }
function handleRegister() { Auth.register(); }
function handleLogout() { Auth.logout(); }
function goBack() { Nav.back(); }
function exitGame() {
    document.getElementById('game-overlay').classList.add('hidden');
    document.getElementById('dashboard-screen').classList.remove('hidden');
}

/* ==========================================
   4. MIRROR MASTER GAME ENGINE (Restored)
   ========================================== */
const GameEngine = {
    gridSize: 10,
    cellSize: 60,
    mirrors: [], // {r, c, angle}
    selectedMirror: null,
    source: {r: 4, c: 1, angle: 0},
    target: {r: 4, c: 8},
    walls: [{r: 2, c: 4}, {r: 3, c: 4}, {r: 4, c: 4}, {r: 5, c: 4}],
    
    init: function() {
        this.renderGrid();
        document.getElementById('start-modal').classList.remove('hidden');
        document.getElementById('result-modal').classList.add('hidden');
        this.reset();
    },

    start: function() {
        document.getElementById('start-modal').classList.add('hidden');
    },

    reset: function() {
        this.mirrors = [];
        this.selectedMirror = null;
        this.source.angle = 0;
        document.getElementById('source-slider').value = 0;
        document.getElementById('source-angle-val').innerText = '0';
        document.getElementById('laser-layer').innerHTML = '';
        document.getElementById('result-modal').classList.add('hidden');
        this.renderGrid();
        this.updateControls();
    },

    renderGrid: function() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        
        for(let r=0; r<this.gridSize; r++) {
            for(let c=0; c<this.gridSize; c++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.r = r;
                cell.dataset.c = c;
                
                // Render Static Objects
                if(r === this.source.r && c === this.source.c) cell.classList.add('source');
                else if(r === this.target.r && c === this.target.c) cell.classList.add('target');
                else if(this.walls.some(w => w.r === r && w.c === c)) cell.classList.add('wall');
                else {
                    cell.onclick = () => this.handleCellClick(r, c);
                }

                // Render Mirrors
                const mirror = this.mirrors.find(m => m.r === r && m.c === c);
                if(mirror) {
                    const mObj = document.createElement('div');
                    mObj.className = 'mirror-obj';
                    mObj.style.transform = `translate(-50%, -50%) rotate(${mirror.angle}deg)`;
                    cell.appendChild(mObj);
                    if(this.selectedMirror === mirror) cell.classList.add('selected');
                }

                grid.appendChild(cell);
            }
        }
    },

    handleCellClick: function(r, c) {
        // Check if existing mirror
        const existing = this.mirrors.find(m => m.r === r && m.c === c);
        
        if(existing) {
            this.selectedMirror = existing;
        } else {
            // Create new mirror
            const newMirror = {r, c, angle: 135};
            this.mirrors.push(newMirror);
            this.selectedMirror = newMirror;
        }
        this.renderGrid();
        this.updateControls();
    },

    updateControls: function() {
        const controls = document.getElementById('mirror-controls');
        if(this.selectedMirror) {
            controls.style.opacity = 1;
            controls.style.pointerEvents = 'all';
            document.getElementById('mirror-slider').value = this.selectedMirror.angle;
            document.getElementById('mirror-angle-val').innerText = this.selectedMirror.angle;
        } else {
            controls.style.opacity = 0.5;
            controls.style.pointerEvents = 'none';
        }
    },

    updateMirrorAngle: function(val) {
        if(this.selectedMirror) {
            this.selectedMirror.angle = parseInt(val);
            document.getElementById('mirror-angle-val').innerText = val;
            this.renderGrid();
        }
    },

    updateSourceAngle: function(val) {
        this.source.angle = parseInt(val);
        document.getElementById('source-angle-val').innerText = val;
    },

    removeMirror: function() {
        if(this.selectedMirror) {
            this.mirrors = this.mirrors.filter(m => m !== this.selectedMirror);
            this.selectedMirror = null;
            this.renderGrid();
            this.updateControls();
        }
    },

    // --- PHYSICS ENGINE ---
    fire: function() {
        const svg = document.getElementById('laser-layer');
        svg.innerHTML = '';
        
        // Starting Point (Center of Source Cell)
        let x = this.source.c * 60 + 30;
        let y = this.source.r * 60 + 30;
        let angle = this.source.angle; // degrees
        
        let pathStr = `M ${x} ${y}`;
        let distRemaining = 2000; // Max laser distance
        let reflections = 0;

        while(distRemaining > 0 && reflections < 20) {
            // Convert angle to vector
            const rad = angle * (Math.PI / 180);
            const dx = Math.cos(rad);
            const dy = Math.sin(rad);

            // Raycast Step (small steps for simplicity)
            let step = 0;
            let hit = false;
            
            while(step < distRemaining) {
                step += 5; // 5px precision
                x += dx * 5;
                y += dy * 5;

                // Check Bounds
                if(x < 0 || x > 600 || y < 0 || y > 600) {
                    hit = true; break;
                }

                // Get Cell coordinates
                const c = Math.floor(x / 60);
                const r = Math.floor(y / 60);

                // Check Wall
                if(this.walls.some(w => w.r === r && w.c === c)) {
                    hit = true; break;
                }

                // Check Target
                if(r === this.target.r && c === this.target.c) {
                    // Check if close to center of target
                    const cx = c*60+30, cy = r*60+30;
                    if(Math.hypot(x-cx, y-cy) < 15) {
                         pathStr += ` L ${x} ${y}`;
                         this.drawLaser(pathStr, svg);
                         setTimeout(() => {
                             document.getElementById('result-modal').classList.remove('hidden');
                         }, 500);
                         return;
                    }
                }

                // Check Mirror
                const mirror = this.mirrors.find(m => m.r === r && m.c === c);
                if(mirror) {
                    // Simple center detection for reflection
                    const cx = c*60+30, cy = r*60+30;
                    if(Math.hypot(x-cx, y-cy) < 10) {
                        // Reflect!
                        // Formula: r = i - 2n (vector) OR Angle approach
                        // Angle Reflection: NewAngle = 2*MirrorAngle - OldAngle
                        angle = (2 * mirror.angle - angle) % 360;
                        pathStr += ` L ${x} ${y}`;
                        hit = true; 
                        reflections++;
                        break; // Break inner step loop to process new angle
                    }
                }
            }
            
            if(!hit && step >= distRemaining) {
                 pathStr += ` L ${x} ${y}`;
                 break;
            } else if (hit && reflections < 20) {
                // Continue loop with new angle
            } else {
                pathStr += ` L ${x} ${y}`;
                break;
            }
            distRemaining -= step;
        }
        
        this.drawLaser(pathStr, svg);
    },

    drawLaser: function(d, svg) {
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", d);
        path.setAttribute("stroke", "#ff0055");
        path.setAttribute("stroke-width", "3");
        path.setAttribute("fill", "none");
        path.setAttribute("stroke-linecap", "round");
        // Animate
        path.style.strokeDasharray = "1000";
        path.style.strokeDashoffset = "1000";
        path.style.animation = "dash 2s linear forwards";
        
        // Add style tag for animation if not exists
        if(!document.getElementById('anim-style')) {
            const s = document.createElement('style');
            s.id = 'anim-style';
            s.innerHTML = `@keyframes dash { to { stroke-dashoffset: 0; } }`;
            document.head.appendChild(s);
        }
        
        svg.appendChild(path);
    }
};

</script>
</body>
</html>