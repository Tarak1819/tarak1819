<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Newton's First Law Football</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

        :root {
            --primary: #FF5E3A;
            --secondary: #1E90FF;
            --bg: #F0F4F8;
            --text: #333;
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            overflow: hidden;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Screens Management */
        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; }
        .active { display: flex; }

        h1, h2, h3 { color: var(--secondary); text-align: center; margin: 10px 0; }
        
        button {
            background: linear-gradient(135deg, var(--primary), #FF2A5F); color: white;
            border: none; padding: 12px 25px; border-radius: 30px; font-size: 16px; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 10px rgba(255,94,58,0.3); transition: transform 0.2s; margin: 10px;
        }
        button:hover { transform: scale(1.05); }
        button.alt { background: linear-gradient(135deg, #7F8C8D, #95A5A6); box-shadow: none; }

        select {
            padding: 12px; margin: 10px; border: 2px solid #ddd; border-radius: 10px; width: 100%; max-width: 300px; font-size: 16px;
        }

        /* Setup Card */
        .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; }

        /* Game UI */
        #game-container { position: relative; width: 100%; max-width: 800px; height: 500px; background: #333; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 5px solid #222; }
        #scoreboard { position: absolute; top: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8); color: white; display: flex; justify-content: space-around; padding: 10px 0; font-weight: bold; font-size: 18px; z-index: 10; font-family: monospace; }
        canvas { display: block; width: 100%; height: 100%; }

        /* Joystick */
        #joystick-area { position: absolute; bottom: 20px; left: 20px; width: 120px; height: 120px; background: rgba(255,255,255,0.2); border-radius: 50%; border: 2px solid rgba(255,255,255,0.5); z-index: 20; display: none; }
        #joystick-knob { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: rgba(255,94,58,0.8); border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* Modals */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; justify-content: center; align-items: center; flex-direction: column; text-align: center; }
        .modal { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; animation: popIn 0.3s; }
        .law-text { background: #f9f9f9; border-left: 5px solid var(--secondary); padding: 15px; text-align: left; margin: 15px 0; font-size: 15px; line-height: 1.5; }
        
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        #huge-message { font-size: 80px; color: white; font-weight: 900; text-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 101; display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

    <div id="screen-setup" class="screen active">
        <div class="card">
            <h2>Newton's First Law Football</h2>
            <div style="width:100%; height:120px; background:url('https://images.unsplash.com/photo-1518605368461-1e1e38ce8ba6?w=600&q=80') center/cover; border-radius:10px; margin-bottom:15px;"></div>
            
            <p>Select your team to begin the physics simulation:</p>
            <select id="user-team" onchange="updateOpponents()">
                <option value="">-- Select Your Country --</option>
                <option value="INDIA" data-color="#1E90FF">INDIA</option>
                <option value="BRAZIL" data-color="#FFD700">BRAZIL</option>
                <option value="ARGENTINA" data-color="#87CEEB">ARGENTINA</option>
                <option value="FRANCE" data-color="#00008B">FRANCE</option>
                <option value="GERMANY" data-color="#FFFFFF">GERMANY</option>
                <option value="SPAIN" data-color="#FF0000">SPAIN</option>
            </select>
            
            <select id="opp-team"><option value="">-- Select Opponent --</option></select>
            
            <button onclick="startMatch()" style="width:100%;">START GAME</button>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div id="game-container">
            <div id="scoreboard">
                <span id="sb-team1">TEAM</span>
                <span id="sb-score">0 - 0</span>
                <span id="sb-timer">00:40</span>
                <span id="sb-team2">OPP</span>
            </div>
            <canvas id="gameCanvas"></canvas>
            <div id="joystick-area"><div id="joystick-knob"></div></div>
            <div id="huge-message">GOAL!</div>
        </div>
    </div>

    <div id="modal-overlay" class="overlay">
        <div id="modal-content" class="modal"></div>
    </div>

<script>
    // --- 1. STATE ---
    // Simplified User State
    let playerName = "Player 1";
    let gameState = { teamColor: '#1E90FF', oppColor: '#FF0000', jNum: '10', phase: 'setup', timer: 40 };
    
    const lawHTML = `
        <div class="law-text">
            <strong>CASE 1 (Inertia of Rest):</strong> A body at rest tends to remain at rest unless an external force acts on it.<br><br>
            <strong>CASE 2 (Inertia of Motion):</strong> A body in motion tends to continue moving in a straight line at a constant speed unless acted upon by a net external force.
        </div>`;

    // --- 2. NAVIGATION & SETUP ---
    function show(id) { 
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
    }
    
    function updateOpponents() {
        const userSel = document.getElementById('user-team');
        const oppSel = document.getElementById('opp-team');
        if(!userSel.value) return;
        gameState.teamColor = userSel.options[userSel.selectedIndex].getAttribute('data-color');
        const teams = ["INDIA", "BRAZIL", "ARGENTINA", "FRANCE", "GERMANY", "SPAIN"];
        oppSel.innerHTML = '<option value="">-- Select Opponent --</option>' + teams.filter(t => t !== userSel.value).map(t => `<option value="${t}">${t}</option>`).join('');
    }

    function startMatch() {
        const t1 = document.getElementById('user-team').value;
        const t2 = document.getElementById('opp-team').value;
        if(!t1 || !t2) return alert("Select teams!");
        
        // Find opponent color mapping
        const oppOptions = document.getElementById('user-team').options;
        for(let i=0; i<oppOptions.length; i++) {
            if(oppOptions[i].value === t2) gameState.oppColor = oppOptions[i].getAttribute('data-color');
        }

        document.getElementById('sb-team1').innerText = t1;
        document.getElementById('sb-team2').innerText = t2;
        
        show('screen-game');
        initEngine();
        
        showModal(`<h1 style="font-size:50px;">3</h1>`, false);
        let c = 2;
        let intv = setInterval(() => {
            if(c > 0) document.getElementById('modal-content').innerHTML = `<h1 style="font-size:50px;">${c}</h1>`;
            else if(c === 0) document.getElementById('modal-content').innerHTML = `<h1 style="font-size:50px;">Let's Go!</h1>`;
            else { clearInterval(intv); hideModal(); startGamePhase1(); }
            c--;
        }, 1000);
    }

    // --- 3. 2D GAME ENGINE ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let animationId;
    
    // Virtual Joystick logic
    let joyActive = false, joyVector = {x:0, y:0};
    const joyArea = document.getElementById('joystick-area');
    const joyKnob = document.getElementById('joystick-knob');
    
    function handleJoy(e) {
        if(!joyActive) return;
        let touch = e.touches ? e.touches[0] : e;
        let rect = joyArea.getBoundingClientRect();
        let centerX = rect.left + rect.width/2;
        let centerY = rect.top + rect.height/2;
        let dx = touch.clientX - centerX;
        let dy = touch.clientY - centerY;
        let dist = Math.sqrt(dx*dx + dy*dy);
        let maxDist = rect.width/2 - 25; // padding
        
        if(dist > maxDist) { dx = (dx/dist)*maxDist; dy = (dy/dist)*maxDist; }
        joyKnob.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
        joyVector = { x: dx/maxDist, y: dy/maxDist }; // Normalized -1 to 1
    }
    
    joyArea.addEventListener('mousedown', (e)=>{joyActive=true; handleJoy(e);});
    document.addEventListener('mousemove', handleJoy);
    document.addEventListener('mouseup', ()=>{ joyActive=false; joyVector={x:0,y:0}; joyKnob.style.transform = 'translate(-50%, -50%)'; });
    joyArea.addEventListener('touchstart', (e)=>{joyActive=true; handleJoy(e);}, {passive:false});
    document.addEventListener('touchmove', (e)=>{if(joyActive) e.preventDefault(); handleJoy(e);}, {passive:false});
    document.addEventListener('touchend', ()=>{ joyActive=false; joyVector={x:0,y:0}; joyKnob.style.transform = 'translate(-50%, -50%)'; });

    // Game Entities
    let ball = { x: 400, y: 250, vx: 0, vy: 0, r: 8, trail: [] };
    let players = [];
    let activePlayer = null;

    function initEngine() {
        canvas.width = 800; canvas.height = 500;
        players = [];
        ball = { x: 400, y: 250, vx: 0, vy: 0, r: 8, trail: [] };
        
        // Create 22 players
        for(let i=0; i<22; i++) {
            players.push({
                x: i < 11 ? 100 + Math.random()*200 : 500 + Math.random()*200,
                y: 50 + Math.random()*400,
                vx: 0, vy: 0, r: 15,
                isUserTeam: i < 11,
                color: i < 11 ? gameState.teamColor : gameState.oppColor
            });
        }
        findActivePlayer();
    }

    function findActivePlayer() {
        let minDist = Infinity;
        players.forEach(p => {
            if(p.isUserTeam) {
                let d = Math.hypot(p.x - ball.x, p.y - ball.y);
                if(d < minDist) { minDist = d; activePlayer = p; }
            }
        });
    }

    function updatePhysics() {
        findActivePlayer();

        // Apply joystick to active player
        if(gameState.phase === 'play1' || gameState.phase === 'quiz_active') {
            activePlayer.vx = joyVector.x * 4;
            activePlayer.vy = joyVector.y * 4;
        }

        // Basic CPU AI (slowly drift towards ball)
        players.forEach(p => {
            if(p !== activePlayer && Math.random() < 0.05) {
                p.vx += (ball.x - p.x) * 0.001;
                p.vy += (ball.y - p.y) * 0.001;
            }
            // Friction and movement
            p.vx *= 0.9; p.vy *= 0.9;
            p.x += p.vx; p.y += p.vy;
            
            // Bounds
            if(p.x < 15) p.x = 15; if(p.x > 785) p.x = 785;
            if(p.y < 15) p.y = 15; if(p.y > 485) p.y = 485;

            // Ball Collision / Dribbling
            let distToBall = Math.hypot(p.x - ball.x, p.y - ball.y);
            if(distToBall < p.r + ball.r + 5) {
                // Kick / Push ball
                let force = (p === activePlayer && (joyVector.x !== 0 || joyVector.y !== 0)) ? 8 : 2;
                let angle = Math.atan2(ball.y - p.y, ball.x - p.x);
                ball.vx = Math.cos(angle) * force;
                ball.vy = Math.sin(angle) * force;
            }
        });

        // Ball physics
        ball.vx *= 0.96; ball.vy *= 0.96; // Grass friction
        ball.x += ball.vx; ball.y += ball.vy;
        
        // Bounds
        if(ball.x < 8) { ball.x = 8; ball.vx *= -1; }
        if(ball.x > 792) { ball.x = 792; ball.vx *= -1; }
        if(ball.y < 8) { ball.y = 8; ball.vy *= -1; }
        if(ball.y > 492) { ball.y = 492; ball.vy *= -1; }

        // Trail logic
        if(Math.abs(ball.vx) > 0.5 || Math.abs(ball.vy) > 0.5) {
            ball.trail.push({x: ball.x, y: ball.y});
            if(ball.trail.length > 25) ball.trail.shift();
        } else if (ball.trail.length > 0) {
            ball.trail.shift(); // fade out when stopped
        }
    }

    function render() {
        // Pitch
        ctx.fillStyle = '#4CAF50'; ctx.fillRect(0, 0, 800, 500);
        // Stripes
        ctx.fillStyle = '#45a049'; for(let i=0; i<800; i+=80) ctx.fillRect(i, 0, 40, 500);
        
        // White lines
        ctx.strokeStyle = 'white'; ctx.lineWidth = 3;
        ctx.strokeRect(10, 10, 780, 480); // Border
        ctx.beginPath(); ctx.moveTo(400, 10); ctx.lineTo(400, 490); ctx.stroke(); // Center line
        ctx.beginPath(); ctx.arc(400, 250, 60, 0, Math.PI*2); ctx.stroke(); // Center circle
        ctx.strokeRect(10, 150, 100, 200); // Left Box
        ctx.strokeRect(690, 150, 100, 200); // Right Box

        // Goals
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fillRect(0, 200, 15, 100); ctx.fillRect(785, 200, 15, 100);

        // Draw Trails (White Trajectory)
        if(ball.trail.length > 1) {
            ctx.beginPath();
            ctx.moveTo(ball.trail[0].x, ball.trail[0].y);
            for(let i=1; i<ball.trail.length; i++) { ctx.lineTo(ball.trail[i].x, ball.trail[i].y); }
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.lineWidth = 4;
            ctx.stroke();
        }

        // Draw Players
        players.forEach(p => {
            // Shadow
            ctx.beginPath(); ctx.arc(p.x, p.y+3, p.r, 0, Math.PI*2); ctx.fillStyle = 'rgba(0,0,0,0.4)'; ctx.fill();
            // Token
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            ctx.fillStyle = p.color; ctx.fill();
            ctx.lineWidth = 2; ctx.strokeStyle = (p.color === '#FFFFFF' || p.color === '#FFD700') ? '#333' : '#FFF'; ctx.stroke();
            
            // If active user player, show name & ID
            if(p === activePlayer) {
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r+4, 0, Math.PI*2); ctx.strokeStyle = '#FFD700'; ctx.lineWidth = 3; ctx.stroke();
                ctx.fillStyle = 'white'; ctx.font = 'bold 12px Arial'; ctx.textAlign = 'center';
                ctx.fillText(playerName, p.x, p.y - 22);
                ctx.fillStyle = 'black'; ctx.font = 'bold 10px Arial';
                ctx.fillText(gameState.jNum, p.x, p.y + 4);
            }
        });

        // Draw Ball
        ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
        ctx.fillStyle = 'white'; ctx.fill();
        ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(ball.x-2, ball.y-2, 2, 0, Math.PI*2); ctx.fill(); // Ball detail
    }

    function gameLoop() {
        if(gameState.phase === 'play1' || gameState.phase === 'quiz_active') {
            updatePhysics();
        }
        render();
        animationId = requestAnimationFrame(gameLoop);
    }

    // --- 4. PHASE 1: 40 SEC PLAY ---
    function startGamePhase1() {
        gameState.phase = 'play1';
        gameState.timer = 40;
        document.getElementById('joystick-area').style.display = 'block';
        gameLoop();

        let tInt = setInterval(() => {
            gameState.timer--;
            document.getElementById('sb-timer').innerText = `00:${gameState.timer.toString().padStart(2,'0')}`;
            if(gameState.timer <= 0) {
                clearInterval(tInt);
                triggerDrinksBreak();
            }
        }, 1000);
    }

    // --- 5. PHASE 2: DRINKS BREAK (LAW EXPLANATION) ---
    function showModal(html, showOverlay=true) {
        document.getElementById('modal-content').innerHTML = html;
        document.getElementById('modal-overlay').style.display = showOverlay ? 'flex' : 'none';
    }
    function hideModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function triggerDrinksBreak() {
        gameState.phase = 'break';
        document.getElementById('joystick-area').style.display = 'none';
        
        showModal(`
            <h2>‚è≥ Drinks Break!</h2>
            <h3>Newton's First Law ‚Äì Law of Inertia</h3>
            <p>This law states that:</p>
            ${lawHTML}
            <p style="color:var(--primary); font-weight:bold;">Reading Time Left: <span id="db-timer">40</span>s</p>
        `);

        // Exactly 40 seconds per prompt
        let t = 40;
        let bInt = setInterval(() => {
            t--; document.getElementById('db-timer').innerText = t;
            if(t <= 0) {
                clearInterval(bInt);
                hideModal();
                alert("Drinks Break Over! Get ready for the interactive challenge.");
                startQuizPhase();
            }
        }, 1000);
    }

    // --- 6. PHASE 3: INTERACTIVE QUIZ LOOP ---
    let quizStep = 0;
    const quizData = [
        { q: "Which case of Newton‚Äôs First Law will you use to kick the ball and restart the game?", ans: 1, state: "REST", success: "You completed a pass by using Case 1!", action: () => { activePlayer.x = 380; activePlayer.y = 250; ball.x = 400; ball.y = 250; ball.vx=0; ball.vy=0; } },
        { q: "The ball is moving towards your teammate. Which case should they use to STOP the moving ball?", ans: 2, state: "MOTION", success: "Awesome! You stopped an object in motion.", action: () => { ball.vx = 8; ball.vy = 2; } },
        { q: "Your teammate needs to pass the ball back to you. Which case applies to put the completely stationary ball back into motion?", ans: 1, state: "REST", success: "Spot on! The stationary ball moved due to applied force.", action: () => { ball.vx = 0; ball.vy = 0; } },
        { q: "You are dribbling and need to dodge a defender. Which case explains why the ball will keep going straight unless you apply a force to turn it?", ans: 2, state: "MOTION", success: "Brilliant dodge! You altered the straight-line motion.", action: () => { gameState.phase='quiz_active'; ball.vx = -5; } },
        { q: "Foul! The ball is placed perfectly still for a free kick. Which case explains why it stays still until you kick it?", ans: 1, state: "REST", success: "Correct! Objects at rest stay at rest.", action: () => { gameState.phase='quiz_pause'; ball.x=600; ball.y=250; ball.vx=0; ball.vy=0; activePlayer.x=580; activePlayer.y=250; } },
        { q: "The striker sees the ball flying towards them. Which case will the striker use to stop the ball before kicking it into the goal?", ans: 2, state: "MOTION", success: "GOAAAAAAL!", action: () => { ball.vx=8; ball.vy=0; } }
    ];

    function startQuizPhase() {
        gameState.phase = 'quiz_pause';
        quizStep = 0;
        document.getElementById('joystick-area').style.display = 'block';
        askQuestion();
    }

    function askQuestion() {
        let step = quizData[quizStep];
        step.action(); // Setup physics state for question
        
        setTimeout(() => {
            gameState.phase = 'quiz_pause'; // freeze physics while asking
            showModal(`
                <h3>Interactive Step ${quizStep + 1} of 6</h3>
                <p style="font-size:18px; margin: 20px 0;">${step.q}</p>
                <div style="display:flex; justify-content:center; gap:10px;">
                    <button onclick="checkAnswer(1)">Case 1</button>
                    <button onclick="checkAnswer(2)">Case 2</button>
                </div>
            `);
        }, 500); // Slight delay to show action
    }

    function checkAnswer(choice) {
        let step = quizData[quizStep];
        if(choice === step.ans) {
            // Correct
            if(quizStep === 5) { // Final Goal
                hideModal();
                ball.x = 750; ball.y = 250; ball.vx = 0; ball.vy = 0; // Move into net
                document.getElementById('sb-score').innerText = "1 - 0";
                document.getElementById('huge-message').style.display = 'block';
                
                setTimeout(() => {
                    document.getElementById('huge-message').style.display = 'none';
                    showModal(`
                        <h2>üèÜ Congratulations!</h2>
                        <p>You have completed the Game by using Newton‚Äôs First Law!</p>
                        <button onclick="location.reload()">Play Again</button>
                    `);
                }, 2000);
            } else {
                showModal(`
                    <h2 style="color:#4CAF50;">Correct!</h2>
                    <p>Congratulations! ${step.success}</p>
                    <button onclick="nextQuestion()">OK</button>
                `);
            }
        } else {
            // WARNING LOOP
            showModal(`
                <h3 style="color:#FF0844;">Are you sure you want to choose Case ${choice}?</h3>
                ${lawHTML}
                <div style="display:flex; justify-content:center; gap:10px;">
                    <button onclick="triggerWarning(${choice}, '${step.state}')">YES</button>
                    <button class="alt" onclick="askQuestion()">NO</button>
                </div>
            `);
        }
    }

    function triggerWarning(c, state) {
        let reason = state === 'REST' ? "the ball is perfectly STILL (At Rest)." : "the ball is already in MOTION.";
        showModal(`
            <h2 style="color:#FF0844;">‚ùå WARNING</h2>
            <p><strong>CASE ${c} CANNOT BE APPLIED because ${reason}</strong></p>
            ${lawHTML}
            <button onclick="askQuestion()">Try Again</button>
        `);
    }

    function nextQuestion() {
        hideModal();
        quizStep++;
        gameState.phase = 'quiz_active'; // Allow a moment of gameplay
        setTimeout(() => { askQuestion(); }, 1500); // 1.5s visual transition
    }

</script>
</body>
</html>